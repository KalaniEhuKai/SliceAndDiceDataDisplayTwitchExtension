<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Config Page</title>
    <link rel="stylesheet" href=style.css>
</head>
<body class="config-page">

    <script src="https://extension-files.twitch.tv/helper/v1/twitch-ext.min.js"></script>
    <!-- If you use any external libraries, such as jQuery, you must include
      them as part of your extension.  Twitch does not allow extensions to link
      to external libraries. -->
    <script src="dependencies/jquery-3.6.3.min.js" type="text/javascript"></script>
    <script src="config.js" type="text/javascript"></script>

    <div>
        <h2>Requirements</h2>
        <p>This extension requires making your local Slice And Dice data file available online.  This will be accomplished using Microsoft OneDrive Sync program and a Microsoft Account *.</p>
        <p><b>WARNING:</b> If you have internet data caps or pay per usage you might not want to do this as the slice and dice data file gets very large (it contains all run histories).</p>
        <p><b>WARNING:</b> This could potentially mess up you slice and dice data file. I don't expect it to, but best to be cautious.  Recommended: back it up before doing this, and frequently afterwards.</p>
        <h2>Instructions</h2>
        <ol>
            <li>Install/Setup OneDrive
                <ol>
                    <li>Create a microsoft account if you don't have one (this can also be done later).</li>
                    <li>Follow this guide to install/setup OneDrive: <href a="https://www.microsoft.com/en-us/microsoft-365/onedrive/download"/>
                        <ul>
                            <li>I turned OFF Documents/Picures/Desktop backup since I didn't want anything besides the Slice And Dice data file getting syncd</li>
                            <li>Note where it creates the root folder - mine was at <b>C:\Users\_user_name_\OneDrive</b></li>
                        </ul>
                    </li>
                </ol>
            </li>
            <br>
            <li>Configure environment to inclue Slice And Dice data file in OneDrive sync
                <ol>
                    <li>Find your data file - mine was at <b>C:\Users\_user_name_\.prefs\slice-and-dice-2</b> (no extension)</li>
                    <li>Create a hard link (similar to symbolic link) so that the OneDrive sync'd folder will pick up that file
                    <ol>
                        <li>Open a cmd prompt (need to right click the command prompt app and select run as administrator to open it), and run the following command (updating if your locations were not the same as mine):</li>
                        <li><b>mklink /h %UserProfile%\OneDrive\slice-and-dice-2 %UserProfile%\.prefs\slice-and-dice-2</b></li>
                    </ol>
                </ol>
            </li>
            <br>
            <li>Configure Sharing to provide slice and dice data file over the internet with a read-only link
                <ol>
                    <li>WARNING: anyone who finds the link to your file can read it.  review the file contents if you want to make sure you aren't sharing any sensitive information.  I do not see any sensitive information in mine.</li>
                    <li>In the OneDrive folder, right click on slice-and-dice-2 file, and select OneDrive > Share
                        <ol>
                            <li>Set it to Share the link with Anyone, Can view, hit Apply</li>
                            <li>Copy the link, and paste it in the field below</li>
                        </ol>
                </ol>
            </li>
        </ol>

        <form id="configurationForm">
            <fieldset>
                <legend> Configuration Values </legend>
                <div>
                    <label for="sliceAndDiceDataFileShareLink">SliceAndDice data file OneDrive share link:</label>
                    <input type="text" id="sliceAndDiceDataFileShareLink" name="sliceAndDiceDataFileShareLink" required>
                </div>
                <div>
                    <label for="extensionRefreshTime">Extension data refresh time (seconds, minimum=1): </label>
                    <input type="number" id="extensionRefreshTime" name="extensionRefreshTime" required min="1">
                </div>
                <div>
                    <input type="submit" id="submitFormButton" value="Submit" class="submit">
                    <div id="status">Config Status: saved (you may close this window)</div>
                </div>
            </fieldset>
        </form>
        <h2>Thanks</h2>
        <p>Big thank you to taodauheo and nirino for creating the <a href="https://docs.google.com/spreadsheets/d/1QeTmPwCAOJCBKy5VgKhupcLrtSFuFa0fPT_zuShv3M8/edit#gid=1658347383" target="_blank">Slice and Dice almanac</a>!</p>

        <h2>Troubleshooting</h2>
        <ul>
            <li>
                <p>If you are getting a delay where OneDrive is not syncing your file for a while, try the following:</p>
                <ul>
                    <li>Open the folder where the SND data is windows explorer, and refresh. Open the Onedrive folder locally in windows explorer, an refresh.  Right click the file > OneDrive > View online .  Maybe it will behave if it knows you're paying attention.</li>
                    <li>Pause then restart syncing.  Click on onedrive in the notification area. Settings gear icon > Pause syncing > 2 hours.  Click on onedrive in the notification area, and hit unpause at the top. </li>
                    <li>It could help to do OneDrive->Setting-> Settings-> Uncheck File On-Demand feature.</li>
                </ul>
            </li>
            <li>
                <p>If anything is not working with the extension, please view your browser's development console where the extension is shown on screen, look for errors, and contact me.  TODO: Ideally it would go somewhere only visible to broadcaster.</p>
            </li>
        </ul>
        <h2>FAQ</h2>
        <p>* Microsoft OneDrive was chosen to make the slide and dice file available online because it is a free, reputable product with simple setup, and shared OneDrive files can be downloaded programmatically (unlike google drive which requires google APIs used in a registered cloud app.)</p>
        <p>(Note that the extension code to get the data from the shared file URL is specific to the REST API that OneDrive uses.  If a better way of exposing the data file online is found, the extension would need to be updated to use it)</p>
    </div>
</body>
</html>
